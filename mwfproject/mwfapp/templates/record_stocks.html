{% extends "base.html" %}
{% load static %}

{% block title %}Add Stock{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-8">

  <h2 class="text-2xl font-bold text-[#643310] mb-6 text-center">Add New Stock</h2>

  <!-- Messages -->
  {% if messages %}
    <div class="mb-4">
      {% for message in messages %}
        <div class="p-3 mb-2 rounded 
                    {% if message.tags == 'error' %}bg-red-100 text-red-700 border border-red-400
                    {% elif message.tags == 'success' %}bg-green-100 text-green-700 border border-green-400
                    {% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <form action="{% url 'recordStocks' %}" method="POST" class="space-y-4" novalidate>
    {% csrf_token %}

    <div>
      <label for="name" class="block text-lg font-medium text-gray-700">Product</label>
      <input type="text" id="name" name="name"
             value="{{ request.POST.name }}"
             class="mt-1 w-full border rounded-md px-3 py-2" placeholder="Product Name" required>
    </div>

    <div>
      <label for="type" class="block text-lg font-medium text-gray-700">Type</label>
      <select id="type" name="type" class="mt-1 w-full border rounded-md px-3 py-2" required>
        <option value="">Select Type</option>
        <option value="Raw Material" {% if request.POST.type == "Raw Material" %}selected{% endif %}>Raw Material</option>
        <option value="Finished Product" {% if request.POST.type == "Finished Product" %}selected{% endif %}>Finished Product</option>
      </select>
    </div>

    <div>
      <label for="quantity" class="block text-lg font-medium text-gray-700">Quantity</label>
      <input type="number" id="quantity" name="quantity" min="0"
             value="{{ request.POST.quantity }}"
             class="mt-1 w-full border rounded-md px-3 py-2" placeholder="e.g. 10" required>
    </div>

    <div>
      <label for="category" class="block text-lg font-medium text-gray-700">Category</label>
      <select id="category" name="category" class="mt-1 w-full border rounded-md px-3 py-2" required>
    <option value="">Select Category</option>
    {% for cat in categories %}
        <option value="{{ cat }}" {% if request.POST.category == cat %}selected{% endif %}>{{ cat }}</option>
    {% endfor %}
</select>

    </div>

    <div>
      <label for="color" class="block text-lg font-medium text-gray-700">Color</label>
      <input type="text" id="color" name="color"
             value="{{ request.POST.color }}"
             class="mt-1 w-full border rounded-md px-3 py-2" placeholder="e.g. Brown">
    </div>

    <div>
      <label for="cost_price" class="block text-lg font-medium text-gray-700">Cost Price (UGX)</label>
      <input type="number" step="0.01" id="cost_price" name="cost_price" min="0"
             value="{{ request.POST.cost_price }}"
             class="mt-1 w-full border rounded-md px-3 py-2" placeholder="e.g. 200000" required>
    </div>

    <div>
      <label for="selling_price" class="block text-lg font-medium text-gray-700">Selling Price (UGX)</label>
      <input type="number" step="0.01" id="selling_price" name="selling_price" min="0"
             value="{{ request.POST.selling_price }}"
             class="mt-1 w-full border rounded-md px-3 py-2" placeholder="e.g. 300000" required>
    </div>

    <div>
      <label for="supplier" class="block text-lg font-medium text-gray-700">Supplier</label>
      <input type="text" id="supplier" name="supplier"
             value="{{ request.POST.supplier }}"
             class="mt-1 w-full border rounded-md px-3 py-2" placeholder="e.g. Lewis Furniture Uganda">
    </div>

    <div>
      <label for="date" class="block text-lg font-medium text-gray-700">Date Added</label>
      <input type="date" id="date" name="date"
             value="{{ request.POST.date }}"
             class="mt-1 w-full border rounded-md px-3 py-2">
    </div>

    <button type="submit"
            class="w-full bg-[#643310] text-white py-2 rounded-md text-xl hover:bg-[#4a260c] transition">
      Add Product
    </button>
  </form>
</div>
<script>
  const dateInput = document.getElementById('date');
  const today = new Date();
  const yesterday = new Date(today);
  yesterday.setDate(today.getDate() - 1);

  function formatDate(d) {
    let month = '' + (d.getMonth() + 1);
    let day = '' + d.getDate();
    const year = d.getFullYear();

    if (month.length < 2) month = '0' + month;
    if (day.length < 2) day = '0' + day;

    return [year, month, day].join('-');
  }

  dateInput.min = formatDate(yesterday);
  dateInput.max = formatDate(today);
  dateInput.value = formatDate(today); // optional default value
</script>
{% endblock %}
